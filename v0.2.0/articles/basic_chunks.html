<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="teal.code">
<title>Basic chunks • teal.code</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Basic chunks">
<meta property="og:description" content="teal.code">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><link rel="stylesheet" href="../consent.css">
<script src="../consent.js" type="text/javascript" charset="utf-8"></script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">teal.code</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>

    <div style="width: 140px; margin-left: 0.5rem;"> <small class="nav-text text-muted me-auto">part of</small> <img src="https://github.com/insightsengineering/hex-stickers/blob/main/PNG/nest.png?raw=true" alt="NEST" style="height: 30px;"><a href="https://pharmaverse.org/" class="external-link"><img src="https://github.com/insightsengineering/hex-stickers/blob/main/PNG/pharmaverse.png?raw=true" alt="pharmaverse" style="height: 28px;"></a> </div>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/teal-code.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/advanced_chunks.html">Advanced chunks</a>
    <a class="dropdown-item" href="../articles/basic_chunks.html">Basic chunks</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
<!-- start dropdown for versions --> <li class="nav-item dropdown">
        <a href="#" class="nav-link dropdown-toggle"
          data-bs-toggle="dropdown" role="button"
          aria-expanded="false" aria-haspopup="true"
          id="dropdown-versions">Versions</a> <div class="dropdown-menu" aria-labelledby="dropdown-versions"> <a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/teal.code/main">main</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/teal.code/latest-tag">latest-tag</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/teal.code/v0.2.0">v0.2.0</a> </div></li>
<!-- end dropdown for versions -->
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/insightsengineering/teal.code">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Basic chunks</h1>
                        <h4 data-toc-skip class="author">NEST
coreDev</h4>
            
            <h4 data-toc-skip class="date">2022-04-22</h4>
      
      
      <div class="d-none name"><code>basic_chunks.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="the-chunks-container">The chunks container<a class="anchor" aria-label="anchor" href="#the-chunks-container"></a>
</h2>
<p>The main concept behind code reproducibility in teal is the chunks
container object. This object consists of two elements:</p>
<ol style="list-style-type: decimal">
<li>A stack of quoted R expressions, each called a “chunk”</li>
<li>An environment carrying variables and their values</li>
</ol>
<p><img src="images/container.png" alt="container" style="width: 100%;"></p>
<p>The chunks container object allows the evaluation of all expressions
it contains in its own isolated environment, thus having no side effects
on the surrounding environment.</p>
<p>The next sections will explain what a chunk is and how it is
evaluated.</p>
</div>
<div class="section level2">
<h2 id="what-is-a-chunk">What is a chunk?<a class="anchor" aria-label="anchor" href="#what-is-a-chunk"></a>
</h2>
<p>A quoted R expression is a necessary step to create a
<strong>chunk</strong> object, which is an R6 object of class
<code>chunk_call</code>. Quoted R expressions can be created in many
different ways, four of which will be described:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fl">3</span></span>
<span></span>
<span><span class="co"># Creating a chunk by quote ------------------------------</span></span>
<span><span class="va">expr_a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">quote</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">a</span>, <span class="va">a</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">expr_a</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## sum(a, a)</span></span></code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Creating a chunk by substitute ------------------------------</span></span>
<span><span class="va">expr_b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">substitute</a></span><span class="op">(</span><span class="va">b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">a</span>, <span class="va">a</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">expr_b</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## b &lt;- sum(a, a)</span></span></code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Creating a chunk by call -------------------------------</span></span>
<span><span class="va">expr_c</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/call.html" class="external-link">call</a></span><span class="op">(</span><span class="st">"sum"</span>, <span class="va">a</span>, <span class="va">a</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">expr_c</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## sum(3, 3)</span></span></code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Creating a chunk by rlang::expr -------------------------------</span></span>
<span><span class="va">expr_d</span> <span class="op">&lt;-</span> <span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/expr.html" class="external-link">expr</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">a</span>, <span class="va">a</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">expr_d</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## sum(a, a)</span></span></code></pre>
<p>To evaluate the expressions of class <code>call</code> or an
assignment given by class <code>&lt;-</code> above, R uses the
<code>eval</code> function. This function evaluates each single
<code>call</code> inside the current environment by default, but it does
contain a parameter to input a specific environment argument to execute
the expression in.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fl">3</span></span>
<span><span class="va">expr_a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">quote</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">a</span>, <span class="va">a</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">expr_b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">substitute</a></span><span class="op">(</span><span class="va">b</span> <span class="op">&lt;-</span> <span class="va">a</span> <span class="op">+</span> <span class="va">a</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/eval.html" class="external-link">eval</a></span><span class="op">(</span><span class="va">expr_a</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 6</span></span></code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/eval.html" class="external-link">eval</a></span><span class="op">(</span><span class="va">expr_b</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">b</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 6</span></span></code></pre>
<p><code>chunk</code> objects can be created and evaluated using the
expressions above as follows:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">chunk_1</span> <span class="op">&lt;-</span> <span class="fu">teal.code</span><span class="fu">::</span><span class="va"><a href="../reference/chunk_call.html">chunk</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>expression <span class="op">=</span> <span class="va">expr_a</span><span class="op">)</span></span>
<span><span class="va">chunk_1</span><span class="op">$</span><span class="fu">eval</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 6</span></span></code></pre>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">chunk_2</span> <span class="op">&lt;-</span> <span class="fu">teal.code</span><span class="fu">::</span><span class="va"><a href="../reference/chunk_call.html">chunk</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>expression <span class="op">=</span> <span class="va">expr_b</span><span class="op">)</span></span>
<span><span class="va">chunk_2</span><span class="op">$</span><span class="fu">eval</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">b</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 6</span></span></code></pre>
<p>Note that <code><a href="../reference/chunk_call.html">teal.code::chunk</a></code> is merely an alias for
<code><a href="../reference/chunk_call.html">teal.code::chunk_call</a></code>. And so the following code is the
same as the above code:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">chunk_1</span> <span class="op">&lt;-</span> <span class="fu">teal.code</span><span class="fu">::</span><span class="va"><a href="../reference/chunk_call.html">chunk_call</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>expression <span class="op">=</span> <span class="va">expr_a</span><span class="op">)</span></span>
<span><span class="va">chunk_1</span><span class="op">$</span><span class="fu">eval</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 6</span></span></code></pre>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">chunk_2</span> <span class="op">&lt;-</span> <span class="fu">teal.code</span><span class="fu">::</span><span class="va"><a href="../reference/chunk_call.html">chunk_call</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>expression <span class="op">=</span> <span class="va">expr_b</span><span class="op">)</span></span>
<span><span class="va">chunk_2</span><span class="op">$</span><span class="fu">eval</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">b</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 6</span></span></code></pre>
<div class="section level3">
<h3 id="motivation-for-the-chunk-chunk_call-object">Motivation for the chunk (chunk_call) object<a class="anchor" aria-label="anchor" href="#motivation-for-the-chunk-chunk_call-object"></a>
</h3>
<p>A quoted R expression can simply be evaluated with the base function,
<code>eval</code>, as demonstrated above. But additional functionalities
are needed for the <code>chunks</code> container to work. Here are some
additional methods, besides <code>eval</code>, that the
<code>chunk</code> object contains:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># answers the question of whether the code executed without error</span></span>
<span><span class="va">chunk_1</span><span class="op">$</span><span class="fu">is_ok</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] TRUE</span></span></code></pre>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># answers the question of whether the code has been executed</span></span>
<span><span class="va">chunk_1</span><span class="op">$</span><span class="fu">is_evaluated</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] TRUE</span></span></code></pre>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># returns error messages, if any, in the form of a string</span></span>
<span><span class="va">chunk_err</span> <span class="op">&lt;-</span> <span class="fu">teal.code</span><span class="fu">::</span><span class="va"><a href="../reference/chunk_call.html">chunk_call</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>expression <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">quote</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"error in chunk"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">chunk_err</span><span class="op">$</span><span class="fu">get_errors</span><span class="op">(</span><span class="op">)</span> <span class="co"># no error before evaluation</span></span></code></pre></div>
<pre><code><span><span class="co">## character(0)</span></span></code></pre>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">chunk_err</span><span class="op">$</span><span class="fu">eval</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">chunk_err</span><span class="op">$</span><span class="fu">get_errors</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "error in chunk"</span></span></code></pre>
<p>Internally, the <code>chunks</code> container will convert quoted
base R expressions into <code>chunk</code> objects as they are pushed
in.</p>
</div>
<div class="section level3">
<h3 id="creation-of-a-chunks-container-object">Creation of a chunks container object<a class="anchor" aria-label="anchor" href="#creation-of-a-chunks-container-object"></a>
</h3>
<p>A chunks container may be initialized as an empty container.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># initializing code chunks -------------------------------------------</span></span>
<span><span class="va">chunks_container_empty</span> <span class="op">&lt;-</span> <span class="fu">teal.code</span><span class="fu">::</span><span class="fu"><a href="../reference/chunks_new.html">chunks_new</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>However, it can also be initialized with a specific environment.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># initializing code chunks -------------------------------------------</span></span>
<span><span class="va">env</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">new.env</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">env</span><span class="op">$</span><span class="va">var_to_be_erased</span> <span class="op">&lt;-</span> <span class="st">"some_value"</span></span>
<span><span class="va">env</span><span class="op">$</span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">chunks_container</span> <span class="op">&lt;-</span> <span class="fu">teal.code</span><span class="fu">::</span><span class="fu"><a href="../reference/chunks_new.html">chunks_new</a></span><span class="op">(</span>envir <span class="op">=</span> <span class="va">env</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># method to list all variables in the chunks environment</span></span>
<span><span class="va">chunks_container</span><span class="op">$</span><span class="fu">ls</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "var_to_be_erased" "x"</span></span></code></pre>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># function to add a chunk to a chunks container object</span></span>
<span><span class="fu">teal.code</span><span class="fu">::</span><span class="fu"><a href="../reference/chunks_push.html">chunks_push</a></span><span class="op">(</span>chunks <span class="op">=</span> <span class="va">chunks_container</span>, expression <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">quote</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># function to get all expressions from a chunks container code stack</span></span>
<span><span class="fu">teal.code</span><span class="fu">::</span><span class="fu"><a href="../reference/chunks_get_rcode.html">chunks_get_rcode</a></span><span class="op">(</span><span class="va">chunks_container</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    chunk_1 </span></span>
<span><span class="co">## "print(x)"</span></span></code></pre>
<p><img src="images/initialize_env.png" alt="reset" style="width: 100%;"></p>
<p>At any point, a chunks container can be reset. Resetting means that
all expressions in its code stack will be emptied and its environment
will be overridden by the inputted environment, which defaults to the
parent environment.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">env</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">new.env</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">env</span><span class="op">$</span><span class="va">anl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>left <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>, right <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">env</span><span class="op">$</span><span class="va">x</span> <span class="op">&lt;-</span> <span class="st">"abc"</span></span>
<span><span class="va">env</span><span class="op">$</span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span></span>
<span><span class="fu">teal.code</span><span class="fu">::</span><span class="fu"><a href="../reference/chunks_reset.html">chunks_reset</a></span><span class="op">(</span>envir <span class="op">=</span> <span class="va">env</span>, chunks <span class="op">=</span> <span class="va">chunks_container</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># note that the variable var_to_be_erased is removed</span></span>
<span><span class="va">chunks_container</span><span class="op">$</span><span class="fu">ls</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "anl" "x"   "y"</span></span></code></pre>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># this function is used to extract values of variables in a chunks container environment</span></span>
<span><span class="co"># note that the variable x is overriden</span></span>
<span><span class="fu">teal.code</span><span class="fu">::</span><span class="fu"><a href="../reference/chunks_get_var.html">chunks_get_var</a></span><span class="op">(</span><span class="st">"x"</span>, chunks <span class="op">=</span> <span class="va">chunks_container</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "abc"</span></span></code></pre>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># note that the code stack has been emptied</span></span>
<span><span class="fu">teal.code</span><span class="fu">::</span><span class="fu"><a href="../reference/chunks_get_rcode.html">chunks_get_rcode</a></span><span class="op">(</span><span class="va">chunks_container</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## character(0)</span></span></code></pre>
<p><img src="images/reset.png" alt="reset" style="width: 100%;"></p>
<p>As mentioned above, the <code><a href="../reference/chunks_push.html">teal.code::chunks_push</a></code> function
is used to push expressions into the chunks container.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">teal.code</span><span class="fu">::</span><span class="fu"><a href="../reference/chunks_push.html">chunks_push</a></span><span class="op">(</span>chunks <span class="op">=</span> <span class="va">chunks_container</span>, expression <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">substitute</a></span><span class="op">(</span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">y</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">teal.code</span><span class="fu">::</span><span class="fu"><a href="../reference/chunks_push.html">chunks_push</a></span><span class="op">(</span>chunks <span class="op">=</span> <span class="va">chunks_container</span>, expression <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">substitute</a></span><span class="op">(</span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="images/push.png" alt="push" style="width: 100%;"></p>
<p>As mentioned above, the <code><a href="../reference/chunks_get_rcode.html">teal.code::chunks_get_rcode</a></code>
function is used to get all expressions pushed into the chunks
container.</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">teal.code</span><span class="fu">::</span><span class="fu"><a href="../reference/chunks_get_rcode.html">chunks_get_rcode</a></span><span class="op">(</span><span class="va">chunks_container</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##             chunk_1             chunk_2 </span></span>
<span><span class="co">##        "y &lt;- y + 1" "x &lt;- paste0(x, y)"</span></span></code></pre>
<p><img src="images/get_rcode.png" alt="get_rcode" style="width: 100%;"></p>
</div>
<div class="section level3">
<h3 id="executing-the-code-stored-in-the-stack">Executing the code stored in the stack<a class="anchor" aria-label="anchor" href="#executing-the-code-stored-in-the-stack"></a>
</h3>
<p>The chunks container also has an <code>eval</code> method which runs
all code inside the chunks container. This method is wrapped inside the
function <code><a href="../reference/chunks_safe_eval.html">teal.code::chunks_safe_eval</a></code>. It evaluates all
chunks inside the container in the order they were pushed and returns
the value of the last evaluated expression. It is not possible to change
the order or run just some of the expressions.</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">teal.code</span><span class="fu">::</span><span class="fu"><a href="../reference/chunks_safe_eval.html">chunks_safe_eval</a></span><span class="op">(</span><span class="va">chunks_container</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "abc6"</span></span></code></pre>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">teal.code</span><span class="fu">::</span><span class="fu"><a href="../reference/chunks_get_var.html">chunks_get_var</a></span><span class="op">(</span><span class="st">"x"</span>, chunks <span class="op">=</span> <span class="va">chunks_container</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "abc6"</span></span></code></pre>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">teal.code</span><span class="fu">::</span><span class="fu"><a href="../reference/chunks_get_var.html">chunks_get_var</a></span><span class="op">(</span><span class="st">"y"</span>, chunks <span class="op">=</span> <span class="va">chunks_container</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 6</span></span></code></pre>
<p><img src="images/eval.png" alt="eval" style="width: 100%;"></p>
<p>It is still possible to push more code expressions into a chunks
container that has already been evaluated. These newly added expressions
may also modify the environment.</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">teal.code</span><span class="fu">::</span><span class="fu"><a href="../reference/chunks_push.html">chunks_push</a></span><span class="op">(</span>chunks <span class="op">=</span> <span class="va">chunks_container</span>, expression <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">quote</a></span><span class="op">(</span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">teal.code</span><span class="fu">::</span><span class="fu"><a href="../reference/chunks_get_rcode.html">chunks_get_rcode</a></span><span class="op">(</span><span class="va">chunks_container</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##             chunk_1             chunk_2             chunk_3 </span></span>
<span><span class="co">##        "y &lt;- y + 1" "x &lt;- paste0(x, y)"           "z &lt;- 10"</span></span></code></pre>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">teal.code</span><span class="fu">::</span><span class="fu"><a href="../reference/chunks_safe_eval.html">chunks_safe_eval</a></span><span class="op">(</span><span class="va">chunks_container</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 10</span></span></code></pre>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">chunks_container</span><span class="op">$</span><span class="fu">ls</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "anl" "x"   "y"   "z"</span></span></code></pre>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">teal.code</span><span class="fu">::</span><span class="fu"><a href="../reference/chunks_get_var.html">chunks_get_var</a></span><span class="op">(</span><span class="st">"z"</span>, chunks <span class="op">=</span> <span class="va">chunks_container</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 10</span></span></code></pre>
<p>Note that code that have already been evaluated will not be
re-evaluated when newly added code is evaluated.</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">teal.code</span><span class="fu">::</span><span class="fu"><a href="../reference/chunks_push.html">chunks_push</a></span><span class="op">(</span></span>
<span>  chunks <span class="op">=</span> <span class="va">chunks_container</span>,</span>
<span>  expression <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">quote</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"I will only be evaluated once"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu">teal.code</span><span class="fu">::</span><span class="fu"><a href="../reference/chunks_safe_eval.html">chunks_safe_eval</a></span><span class="op">(</span><span class="va">chunks_container</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "I will only be evaluated once"</span></span></code></pre>
<pre><code><span><span class="co">## [1] "I will only be evaluated once"</span></span></code></pre>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">teal.code</span><span class="fu">::</span><span class="fu"><a href="../reference/chunks_push.html">chunks_push</a></span><span class="op">(</span>chunks <span class="op">=</span> <span class="va">chunks_container</span>, expression <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">quote</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># note that the string "I will only be evaluated once" is not printed again</span></span>
<span><span class="fu">teal.code</span><span class="fu">::</span><span class="fu"><a href="../reference/chunks_safe_eval.html">chunks_safe_eval</a></span><span class="op">(</span><span class="va">chunks_container</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## NULL</span></span></code></pre>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># z is removed</span></span>
<span><span class="va">chunks_container</span><span class="op">$</span><span class="fu">ls</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "anl" "x"   "y"</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="handling-errors-and-warnings">Handling errors (and warnings)<a class="anchor" aria-label="anchor" href="#handling-errors-and-warnings"></a>
</h3>
<p>The function <code><a href="../reference/chunks_safe_eval.html">teal.code::chunks_safe_eval</a></code> is named
<code>"safe_eval"</code> because it performs an additional step to
handle errors by calling another method of the chunks container object,
<code>validate_is_ok</code>. If any error occurs during the evaluation
of expressions pushed into the chunks container, the error is handled
and stored in the <code>chunk</code> object that contains the
expression, and thus no error is thrown to the calling environment.</p>
<p>The function <code><a href="../reference/chunks_is_ok.html">teal.code::chunks_is_ok</a></code> will return
<code>TRUE</code> if all evaluated expressions in the chunks container
evaluated without throwing an error.</p>
<p><code><a href="../reference/chunks_validate_is_ok.html">teal.code::chunks_validate_is_ok</a></code> returns a useful
<code>validate(need(...))</code> which a shiny app will use to display
an error message in the UI instead of crashing the app.</p>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">teal.code</span><span class="fu">::</span><span class="fu"><a href="../reference/chunks_is_ok.html">chunks_is_ok</a></span><span class="op">(</span><span class="va">chunks_container</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] TRUE</span></span></code></pre>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">teal.code</span><span class="fu">::</span><span class="fu"><a href="../reference/chunks_validate_is_ok.html">chunks_validate_is_ok</a></span><span class="op">(</span>chunks <span class="op">=</span> <span class="va">chunks_container</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Trying an error inside a chunk ------------------------</span></span>
<span><span class="fu">teal.code</span><span class="fu">::</span><span class="fu"><a href="../reference/chunks_push.html">chunks_push</a></span><span class="op">(</span>chunks <span class="op">=</span> <span class="va">chunks_container</span>, expression <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">quote</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"ERROR"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">teal.code</span><span class="fu">::</span><span class="fu"><a href="../reference/chunks_safe_eval.html">chunks_safe_eval</a></span><span class="op">(</span><span class="va">chunks_container</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error: The following errors(s) occurred:</span></span>
<span><span class="co">## ERROR</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## when evaluating the following code:</span></span>
<span><span class="co">## stop("ERROR")</span></span></code></pre>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">teal.code</span><span class="fu">::</span><span class="fu"><a href="../reference/chunks_is_ok.html">chunks_is_ok</a></span><span class="op">(</span><span class="va">chunks_container</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] FALSE</span></span></code></pre>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># internally, teal.code::chunks_safe_eval calls teal.code::chunks_validate_is_ok before returning</span></span>
<span><span class="fu">teal.code</span><span class="fu">::</span><span class="fu"><a href="../reference/chunks_validate_is_ok.html">chunks_validate_is_ok</a></span><span class="op">(</span>chunks <span class="op">=</span> <span class="va">chunks_container</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error: The following errors(s) occurred:</span></span>
<span><span class="co">## ERROR</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## when evaluating the following code:</span></span>
<span><span class="co">## stop("ERROR")</span></span></code></pre>
<p><img src="images/is_ok.png" alt="is_ok" style="width: 100%;"></p>
<p>The use of the <code><a href="../reference/chunks_safe_eval.html">teal.code::chunks_safe_eval</a></code> is good
practice in a reactive context. Since errors are not thrown to the
environment calling the chunks container, it will not crash the shiny
app, which is a good thing. However, the shiny app will also not know
that an error has occurred. Calling
<code><a href="../reference/chunks_safe_eval.html">teal.code::chunks_safe_eval</a></code> instead of the
<code>eval</code> method of the chunks container ensures that a
validation step occurs.</p>
</div>
<div class="section level3">
<h3 id="tutorial-summary">Tutorial Summary<a class="anchor" aria-label="anchor" href="#tutorial-summary"></a>
</h3>
<p>In summary:</p>
<ol style="list-style-type: decimal">
<li>chunks containers host code snippets</li>
<li>chunks containers host their own environment</li>
<li>chunks container can be accessed to retrieve variables from the
environment using <code><a href="../reference/chunks_get_var.html">teal.code::chunks_get_var</a></code>
</li>
<li>expressions can be added to the chunks container by
<code><a href="../reference/chunks_push.html">teal.code::chunks_push</a></code>
</li>
<li>code inside a container is executed by its <code>eval</code>
method.</li>
<li>
<code><a href="../reference/chunks_is_ok.html">teal.code::chunks_is_ok</a></code> allows checking for execution
errors</li>
<li>
<code><a href="../reference/chunks_validate_is_ok.html">teal.code::chunks_validate_is_ok</a></code> allows a shiny app to
display a validate message of the errors in the UI</li>
<li>
<code><a href="../reference/chunks_safe_eval.html">teal.code::chunks_safe_eval</a></code> will evaluate all snippets
of the chunks container and then call <code>validate(need(...))</code>
to let a shiny app silently handle any errors that occurred so that
error messages can be outputted in the UI.</li>
</ol>
<p>For more information about the implementation of chunks inside of
shiny/teal module, please go on to the Advanced chunks article.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="nest">
  <p>teal.code is a part of the <strong>NEST</strong> and <a href="https://pharmaverse.org/" class="external-link"><strong>pharmaverse</strong></a>.</p>
</div>
<script type="text/javascript" src="../analytics.js"></script></footer>
</div>

  

  

  </body>
</html>
