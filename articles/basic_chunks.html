<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="teal.code">
<title>Basic chunks • teal.code</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Basic chunks">
<meta property="og:description" content="teal.code">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">teal.code</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0.9003</small>

    <div style="width: 140px; margin-left: 0.5rem;"> <small class="nav-text text-muted me-auto">part of</small> <img src="https://github.com/insightsengineering/hex-stickers/blob/main/PNG/nest.png?raw=true" alt="NEST" style="height: 30px;"><a href="https://pharmaverse.org/" class="external-link"><img src="https://github.com/insightsengineering/hex-stickers/blob/main/PNG/pharmaverse.png?raw=true" alt="pharmaverse" style="height: 30px;"></a> </div>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/teal-code.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/advanced_chunks.html">Advanced chunks</a>
    <a class="dropdown-item" href="../articles/basic_chunks.html">Basic chunks</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
<!-- start_releases -->
<li class="dropdown">
	<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
Other releases
<span class="caret"></span></a><ul class="dropdown-menu" role="menu">
   <li><a href="../index.html">latest</a></li>
   <li><a href="..//index.html"></a></li>
</ul></li>
<!-- end_releases -->
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/insightsengineering/teal.code">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Basic chunks</h1>
                        <h4 data-toc-skip class="author">NEST
coreDev</h4>
            
            <h4 data-toc-skip class="date">2022-04-22</h4>
      
      
      <div class="d-none name"><code>basic_chunks.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="the-chunks-container">The chunks container<a class="anchor" aria-label="anchor" href="#the-chunks-container"></a>
</h2>
<p>The main concept behind the code chunks is the chunks container. This
container consists of two elements:</p>
<ol style="list-style-type: decimal">
<li>A stack of quoted R expressions, each called a “chunk”</li>
<li>An environment carrying variable values</li>
</ol>
<p><img src="images/container.png" alt="container" style="width: 100%;"></p>
<p>Each chunk can be evaluated inside the current environment. To
evaluate all chunks inside the same environment, the <code>chunks</code>
R6 object was created in <code>teal.code</code>. We refer to this object
as “chunks container”. It internally has a stack of <code>chunk</code>
objects and the environment where they will get evaluated.</p>
<p>The next sections will explain what a chunk is and how it is
evaluated.</p>
</div>
<div class="section level2">
<h2 id="what-is-a-chunk">What is a chunk?<a class="anchor" aria-label="anchor" href="#what-is-a-chunk"></a>
</h2>
<p>A quoted R expression is a necessary step to create a
<strong>chunk</strong> object, which is an R6 object of class
<code>chunk_call</code>. Quoted R expressions can be created in three
different ways:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">a</span> <span class="op">&lt;-</span> <span class="fl">3</span>

<span class="co"># Creating a chunk by quote ------------------------------</span>
<span class="va">expr_a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">quote</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">a</span>, <span class="va">a</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">expr_a</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## sum(a, a)</span></code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">expr_a</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] "call"</span></code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Creating a chunk by bquote ------------------------------</span>
<span class="va">expr_b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/bquote.html" class="external-link">bquote</a></span><span class="op">(</span><span class="va">b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">a</span>, <span class="va">a</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">expr_b</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## b &lt;- sum(a, a)</span></code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">expr_b</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] "&lt;-"</span></code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Creating a chunk by call -------------------------------</span>
<span class="va">expr_c</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/call.html" class="external-link">call</a></span><span class="op">(</span><span class="st">"sum"</span>, <span class="va">a</span>, <span class="va">a</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">expr_c</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## sum(3, 3)</span></code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">expr_c</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] "call"</span></code></pre>
<p>To evaluate the expressions of class <code>call</code> or an
assignment given by class <code>&lt;-</code> above, R uses the
<code>eval</code> function. This function evaluates each single
<code>call</code> inside the current environment, in case no other
environment is given. In the example code you can see what happens upon
evaluating the expressions:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">a</span> <span class="op">&lt;-</span> <span class="fl">3</span>
<span class="va">expr_a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">quote</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">a</span>, <span class="va">a</span><span class="op">)</span><span class="op">)</span>
<span class="va">expr_b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/bquote.html" class="external-link">bquote</a></span><span class="op">(</span><span class="va">b</span> <span class="op">&lt;-</span> <span class="va">a</span> <span class="op">+</span> <span class="va">a</span><span class="op">)</span>
<span class="va">expr_c</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/call.html" class="external-link">call</a></span><span class="op">(</span><span class="st">"sum"</span>, <span class="va">a</span>, <span class="va">a</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/eval.html" class="external-link">eval</a></span><span class="op">(</span><span class="va">expr_a</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] 6</span></code></pre>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/eval.html" class="external-link">eval</a></span><span class="op">(</span><span class="va">expr_b</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">b</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] 6</span></code></pre>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/eval.html" class="external-link">eval</a></span><span class="op">(</span><span class="va">expr_c</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] 6</span></code></pre>
<p>Now <code>chunk</code> objects can be created and evaluated using the
expressions above as follows:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">a</span> <span class="op">&lt;-</span> <span class="fl">3</span>
<span class="va">expr_a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">quote</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">a</span>, <span class="va">a</span><span class="op">)</span><span class="op">)</span>
<span class="va">expr_b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/bquote.html" class="external-link">bquote</a></span><span class="op">(</span><span class="va">b</span> <span class="op">&lt;-</span> <span class="va">a</span> <span class="op">+</span> <span class="va">a</span><span class="op">)</span>
<span class="va">expr_c</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/call.html" class="external-link">call</a></span><span class="op">(</span><span class="st">"sum"</span>, <span class="va">a</span>, <span class="va">a</span><span class="op">)</span>

<span class="va">chunk_1</span> <span class="op">&lt;-</span> <span class="fu">teal.code</span><span class="fu">::</span><span class="va"><a href="../reference/chunk_call.html">chunk</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>expression <span class="op">=</span> <span class="va">expr_a</span><span class="op">)</span>
<span class="va">chunk_1</span><span class="op">$</span><span class="fu">eval</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] 6</span></code></pre>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">chunk_2</span> <span class="op">&lt;-</span> <span class="fu">teal.code</span><span class="fu">::</span><span class="va"><a href="../reference/chunk_call.html">chunk</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>expression <span class="op">=</span> <span class="va">expr_b</span><span class="op">)</span>
<span class="va">chunk_2</span><span class="op">$</span><span class="fu">eval</span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">b</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] 6</span></code></pre>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">chunk_3</span> <span class="op">&lt;-</span> <span class="fu">teal.code</span><span class="fu">::</span><span class="va"><a href="../reference/chunk_call.html">chunk</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>expression <span class="op">=</span> <span class="va">expr_c</span><span class="op">)</span>
<span class="va">chunk_3</span><span class="op">$</span><span class="fu">eval</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] 6</span></code></pre>
<p>Note that <code><a href="../reference/chunk_call.html">teal.code::chunk</a></code> is merely an alias for
<code><a href="../reference/chunk_call.html">teal.code::chunk_call</a></code>. And so the following code is the
same as the above code:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">chunk_1</span> <span class="op">&lt;-</span> <span class="fu">teal.code</span><span class="fu">::</span><span class="va"><a href="../reference/chunk_call.html">chunk_call</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>expression <span class="op">=</span> <span class="va">expr_a</span><span class="op">)</span>
<span class="va">chunk_1</span><span class="op">$</span><span class="fu">eval</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] 6</span></code></pre>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">chunk_2</span> <span class="op">&lt;-</span> <span class="fu">teal.code</span><span class="fu">::</span><span class="va"><a href="../reference/chunk_call.html">chunk_call</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>expression <span class="op">=</span> <span class="va">expr_b</span><span class="op">)</span>
<span class="va">chunk_2</span><span class="op">$</span><span class="fu">eval</span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">b</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] 6</span></code></pre>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">chunk_3</span> <span class="op">&lt;-</span> <span class="fu">teal.code</span><span class="fu">::</span><span class="va"><a href="../reference/chunk_call.html">chunk_call</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>expression <span class="op">=</span> <span class="va">expr_c</span><span class="op">)</span>
<span class="va">chunk_3</span><span class="op">$</span><span class="fu">eval</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] 6</span></code></pre>
<div class="section level3">
<h3 id="motivation-for-the-chunk-chunk_call-object">Motivation for the chunk (chunk_call) object<a class="anchor" aria-label="anchor" href="#motivation-for-the-chunk-chunk_call-object"></a>
</h3>
<p>A quoted R expression can simply be evaluated with the base function,
<code>eval</code>, as demonstrated above. But additional functionalities
are needed for the <code>chunks</code> container to work. Here are some
additional methods, besides <code>eval</code>, that the
<code>chunk</code> object contains:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># answers the question of whether the code executed without error</span>
<span class="va">chunk_1</span><span class="op">$</span><span class="fu">is_ok</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] TRUE</span></code></pre>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># answers the question of whether the code has been executed</span>
<span class="va">chunk_1</span><span class="op">$</span><span class="fu">is_evaluated</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] TRUE</span></code></pre>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># returns error messages, if any, in the form of a string</span>
<span class="va">chunk_err</span> <span class="op">&lt;-</span> <span class="fu">teal.code</span><span class="fu">::</span><span class="va"><a href="../reference/chunk_call.html">chunk_call</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>expression <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">quote</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"error in chunk"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">chunk_err</span><span class="op">$</span><span class="fu">get_errors</span><span class="op">(</span><span class="op">)</span> <span class="co"># no error before evaluation</span></code></pre></div>
<pre><code><span class="co">## character(0)</span></code></pre>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">chunk_err</span><span class="op">$</span><span class="fu">eval</span><span class="op">(</span><span class="op">)</span>
<span class="va">chunk_err</span><span class="op">$</span><span class="fu">get_errors</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] "error in chunk"</span></code></pre>
<p>Internally, the <code>chunks</code> container will convert quoted R
expressions into <code>chunk</code> objects as they are pushed in.</p>
<p>The next sections will tell in a step by step guide which features
are provided by the <code>chunks</code> container object.</p>
</div>
</div>
<div class="section level2">
<h2 id="step-by-step-to-understand-chunks-container">Step by step to understand chunks container<a class="anchor" aria-label="anchor" href="#step-by-step-to-understand-chunks-container"></a>
</h2>
<div class="section level3">
<h3 id="general-information">General information<a class="anchor" aria-label="anchor" href="#general-information"></a>
</h3>
<p>Normally as a module developer the chunks container will be used
within the <code>server</code> function of a shiny/teal module. This
enables storing the chunks container inside the shiny session. For
simplicity reasons this feature will be used in the tutorial. To store a
container inside the shiny session simply use the call
<code><a href="../reference/init_chunks.html">init_chunks()</a></code> and the <code>chunks</code> R6 object will be
stored in <code>session$userData$&lt;MODULENAME&gt;$chunks</code>. After
using <code><a href="../reference/init_chunks.html">init_chunks()</a></code>, the functions dealing with chunks
container can be used. Those are recommended. If for any reasons you
want to use your own chunks container, it is possible. Please see the
last section of this article for more information. So for now, we just
call <code><a href="../reference/init_chunks.html">teal.code::init_chunks()</a></code>.</p>
<p>As a simulation of the teal environment the <code>init_session</code>
function is provided:</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># pseudo code simulating a shiny session ----------------------------</span>
<span class="va">init_session</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">session</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">new.env</a></span><span class="op">(</span><span class="op">)</span>
  <span class="va">session</span><span class="op">$</span><span class="va">userData</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">new.env</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># nolint</span>
  <span class="va">session</span><span class="op">$</span><span class="va">ns</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"x-"</span>, <span class="va">x</span><span class="op">)</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">session</span><span class="op">)</span>
<span class="op">}</span>

<span class="co"># initializing code chunks -------------------------------------------</span>
<span class="va">session</span> <span class="op">&lt;-</span> <span class="fu">init_session</span><span class="op">(</span><span class="op">)</span>
<span class="fu">teal.code</span><span class="fu">::</span><span class="fu"><a href="../reference/init_chunks.html">init_chunks</a></span><span class="op">(</span>session <span class="op">=</span> <span class="va">session</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="feature-1-reset-initialize-the-environment">Feature 1: Reset (initialize the environment)<a class="anchor" aria-label="anchor" href="#feature-1-reset-initialize-the-environment"></a>
</h3>
<p>Normally reproducible code will be used inside a
<code>renderPlot</code> or <code>renderTable</code> call of a shiny
module. For simplicity reasons we just use the <em>pseudo</em> shiny
session defined above in this tutorial. As a first step the chunks
container should be handed over an analysis dataset (<code>anl</code>)
and two variables <code>x = "abc"</code>, <code>y = 5</code>. Therefore
you need to use the <code><a href="../reference/chunks_reset.html">teal.code::chunks_reset</a></code> function. It
not only empties all current chunks inside the container, but also hands
over all variables from the current environment to the container
environment.</p>
<p>To check that it worked as expected the function
<code><a href="../reference/chunks_get_var.html">teal.code::chunks_get_var</a></code> will be used and check that the
values inside the chunks container are equal to the values from the
environment.</p>
<p>You can use this code snippet:</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Adding variables to the chunks container -------------------------------------</span>
<span class="va">anl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>left <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>, right <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="st">"abc"</span>
<span class="va">y</span> <span class="op">&lt;-</span> <span class="fl">5</span>

<span class="fu">teal.code</span><span class="fu">::</span><span class="fu"><a href="../reference/chunks_reset.html">chunks_reset</a></span><span class="op">(</span><span class="op">)</span>

<span class="co"># Double check variables were handed over-----------------------------</span>
<span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu">teal.code</span><span class="fu">::</span><span class="fu"><a href="../reference/chunks_get_var.html">chunks_get_var</a></span><span class="op">(</span><span class="st">"x"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] TRUE</span></code></pre>
<p><img src="images/reset.png" alt="reset" style="width: 100%;"></p>
</div>
<div class="section level3">
<h3 id="feature-2-push---adding-code-snippets">Feature 2: Push - adding code snippets<a class="anchor" aria-label="anchor" href="#feature-2-push---adding-code-snippets"></a>
</h3>
<p>To populate the chunks container, a chunk can be added using the
<code><a href="../reference/chunks_push.html">teal.code::chunks_push</a></code> function. Here two code snippets
will be added:</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">teal.code</span><span class="fu">::</span><span class="fu"><a href="../reference/chunks_push.html">chunks_push</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/bquote.html" class="external-link">bquote</a></span><span class="op">(</span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">y</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="fu">teal.code</span><span class="fu">::</span><span class="fu"><a href="../reference/chunks_push.html">chunks_push</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/bquote.html" class="external-link">bquote</a></span><span class="op">(</span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="images/push.png" alt="push" style="width: 100%;"></p>
</div>
<div class="section level3">
<h3 id="feature-3-get-r-code---showing-the-chunks-container-code">Feature 3: Get R code - showing the chunks container code<a class="anchor" aria-label="anchor" href="#feature-3-get-r-code---showing-the-chunks-container-code"></a>
</h3>
<p>To reproduce what was done inside the chunks container, it is
necessary to render the R code inside them. Therefore the chunks
container can display all its code by calling
<code><a href="../reference/chunks_get_rcode.html">teal.code::chunks_get_rcode</a></code>. You can run this example to
see the code:</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">teal.code</span><span class="fu">::</span><span class="fu"><a href="../reference/chunks_get_rcode.html">chunks_get_rcode</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##             chunk_1             chunk_2 </span>
<span class="co">##        "y &lt;- y + 1" "x &lt;- paste0(x, y)"</span></code></pre>
<p><img src="images/get_rcode.png" alt="get_rcode" style="width: 100%;"></p>
</div>
<div class="section level3">
<h3 id="feature-4-eval---evaluating-the-code">Feature 4: <code>eval</code> - evaluating the code<a class="anchor" aria-label="anchor" href="#feature-4-eval---evaluating-the-code"></a>
</h3>
<p>The <code>eval</code> function is responsible to run the code inside
the chunks container. The <code>eval</code> function of a chunks
container is called <code><a href="../reference/chunks_safe_eval.html">teal.code::chunks_safe_eval</a></code>. It
evaluates all chunks inside the container in the order they were pushed.
It is not possible to change the order or run just pieces of the
code.</p>
<p>The <code><a href="../reference/chunks_safe_eval.html">teal.code::chunks_safe_eval</a></code> will always return the
value of the last evaluation. By <code><a href="../reference/chunks_get_var.html">teal.code::chunks_get_var</a></code>
it is possible to retrieve specific variables after evaluation.</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">teal.code</span><span class="fu">::</span><span class="fu"><a href="../reference/chunks_safe_eval.html">chunks_safe_eval</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] "abc6"</span></code></pre>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">teal.code</span><span class="fu">::</span><span class="fu"><a href="../reference/chunks_get_var.html">chunks_get_var</a></span><span class="op">(</span><span class="st">"x"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] "abc6"</span></code></pre>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">teal.code</span><span class="fu">::</span><span class="fu"><a href="../reference/chunks_get_var.html">chunks_get_var</a></span><span class="op">(</span><span class="st">"y"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] 6</span></code></pre>
<p><img src="images/eval.png" alt="eval" style="width: 100%;"></p>
</div>
<div class="section level3">
<h3 id="feature-5-is-ok---check-for-errors-and-warnings">Feature 5: Is ok - check for errors and warnings<a class="anchor" aria-label="anchor" href="#feature-5-is-ok---check-for-errors-and-warnings"></a>
</h3>
<p>A chunks container object also has its own <code>eval</code> method.
The function <code><a href="../reference/chunks_safe_eval.html">teal.code::chunks_safe_eval</a></code> is merely a
wrapper of this method. It is named <code>"safe_eval"</code> because it
performs an additional step to handle errors by calling another method
of the chunks container object, <code>validate_is_ok</code>. If any
error occurs during the evaluation of expressions pushed into the chunks
container, the error is handled and stored in the <code>chunk</code>
object that contains the expression, and thus no error is thrown to the
calling environment.</p>
<p>The most important function to check if everything went fine is
<code><a href="../reference/chunks_is_ok.html">teal.code::chunks_is_ok</a></code>. It will return <code>TRUE</code>
in the case where everything was fine.</p>
<p><code><a href="../reference/chunks_validate_is_ok.html">teal.code::chunks_validate_is_ok</a></code> returns a useful
<code>validate(need(...))</code> message inside the shiny app in case
something went wrong.</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">teal.code</span><span class="fu">::</span><span class="fu"><a href="../reference/chunks_is_ok.html">chunks_is_ok</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] TRUE</span></code></pre>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">teal.code</span><span class="fu">::</span><span class="fu"><a href="../reference/chunks_validate_is_ok.html">chunks_validate_is_ok</a></span><span class="op">(</span><span class="op">)</span>

<span class="co"># Trying an error inside a chunk ------------------------</span>
<span class="fu">teal.code</span><span class="fu">::</span><span class="fu"><a href="../reference/chunks_push.html">chunks_push</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">quote</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"ERROR"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="fu">teal.code</span><span class="fu">::</span><span class="fu"><a href="../reference/chunks_safe_eval.html">chunks_safe_eval</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Error: The following errors(s) occurred:</span>
<span class="co">## ERROR</span>
<span class="co">## </span>
<span class="co">## when evaluating the following code:</span>
<span class="co">## stop("ERROR")</span></code></pre>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">teal.code</span><span class="fu">::</span><span class="fu"><a href="../reference/chunks_is_ok.html">chunks_is_ok</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] FALSE</span></code></pre>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">teal.code</span><span class="fu">::</span><span class="fu"><a href="../reference/chunks_validate_is_ok.html">chunks_validate_is_ok</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Error: The following errors(s) occurred:</span>
<span class="co">## ERROR</span>
<span class="co">## </span>
<span class="co">## when evaluating the following code:</span>
<span class="co">## stop("ERROR")</span></code></pre>
<p><img src="images/is_ok.png" alt="is_ok" style="width: 100%;"></p>
<p>The use of the <code><a href="../reference/chunks_safe_eval.html">teal.code::chunks_safe_eval</a></code> is extremely
important in a reactive context, such as inside the server function of a
shiny app. Since errors are not thrown to the environment calling the
chunks container, it will not crash the shiny app, which is a good
thing. However, the shiny app will also not know that an error has
occurred. Calling <code><a href="../reference/chunks_safe_eval.html">teal.code::chunks_safe_eval</a></code> instead of
the <code>eval</code> method of the chunks container ensures that a
validation step occurs.</p>
</div>
<div class="section level3">
<h3 id="tutorial-summary">Tutorial Summary<a class="anchor" aria-label="anchor" href="#tutorial-summary"></a>
</h3>
<p>In summary:</p>
<ol style="list-style-type: decimal">
<li>chunks containers host code snippets</li>
<li>chunks containers host their own environment</li>
<li>chunks containers are initialized inside shiny/teal using
<code><a href="../reference/init_chunks.html">teal.code::init_chunks</a></code>
</li>
<li>chunks container can be accessed to retrieve variables from the
environment using <code><a href="../reference/chunks_get_var.html">teal.code::chunks_get_var</a></code>
</li>
<li>chunks can be added to the chunks container by
<code><a href="../reference/chunks_push.html">teal.code::chunks_push</a></code>
</li>
<li>All chunks inside a container can be executed by
<code><a href="../reference/chunks_safe_eval.html">teal.code::chunks_safe_eval</a></code>
</li>
<li>
<code><a href="../reference/chunks_validate_is_ok.html">teal.code::chunks_validate_is_ok</a></code> and
<code><a href="../reference/chunks_is_ok.html">teal.code::chunks_is_ok</a></code> allow checking for execution
errors</li>
</ol>
<p>The whole implementation of this tutorial is given in the
<em>gif</em> below:</p>
<p><img src="images/chunks_animation.gif" alt="chunks_animation" style="width: 100%;"></p>
<p>For more information about the implementation of chunks inside of
shiny/teal module, please visit the Advanced chunks article.</p>
<p>Please find below the implicit vs. explicit usage of code chunks
containers.</p>
<hr>
</div>
<div class="section level3">
<h3 id="implementation-of-code-chunks-containers">Implementation of code chunks containers<a class="anchor" aria-label="anchor" href="#implementation-of-code-chunks-containers"></a>
</h3>
<p>There are two ways to initialize the code chunks inside shiny
modules:</p>
<ul>
<li><p>Using R6 implementation:
<code>session_chunks &lt;- chunks$new()</code>.</p></li>
<li><p>Using <code>teal.code</code> wrappers:
<code><a href="../reference/init_chunks.html">teal.code::init_chunks()</a></code>.</p></li>
</ul>
<p>The <code>teal.code</code> functions can be used in both cases:</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">session</span> <span class="op">&lt;-</span> <span class="fu">init_session</span><span class="op">(</span><span class="op">)</span>
<span class="fu">teal.code</span><span class="fu">::</span><span class="fu"><a href="../reference/init_chunks.html">init_chunks</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">a</span> <span class="op">&lt;-</span> <span class="fl">1</span>
<span class="va">b</span> <span class="op">&lt;-</span> <span class="fl">2</span>

<span class="co"># set a &amp; b in env</span>
<span class="fu">teal.code</span><span class="fu">::</span><span class="fu"><a href="../reference/chunks_reset.html">chunks_reset</a></span><span class="op">(</span><span class="op">)</span>
<span class="co"># push to chunks</span>
<span class="fu">teal.code</span><span class="fu">::</span><span class="fu"><a href="../reference/chunks_push.html">chunks_push</a></span><span class="op">(</span>expression <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/bquote.html" class="external-link">bquote</a></span><span class="op">(</span><span class="va">a</span> <span class="op">&lt;-</span> <span class="va">a</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="co"># eval gives return value</span>
<span class="fu">teal.code</span><span class="fu">::</span><span class="fu"><a href="../reference/chunks_safe_eval.html">chunks_safe_eval</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] 2</span></code></pre>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu">teal.code</span><span class="fu">::</span><span class="fu"><a href="../reference/chunks_get_var.html">chunks_get_var</a></span><span class="op">(</span><span class="st">"a"</span><span class="op">)</span> <span class="op">==</span> <span class="fl">2</span><span class="op">)</span>

<span class="fu">teal.code</span><span class="fu">::</span><span class="fu"><a href="../reference/chunks_push.html">chunks_push</a></span><span class="op">(</span>expression <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/bquote.html" class="external-link">bquote</a></span><span class="op">(</span><span class="va">c</span> <span class="op">&lt;-</span> <span class="va">a</span> <span class="op">+</span> <span class="va">b</span><span class="op">)</span><span class="op">)</span>
<span class="fu">teal.code</span><span class="fu">::</span><span class="fu"><a href="../reference/chunks_safe_eval.html">chunks_safe_eval</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] 4</span></code></pre>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu">teal.code</span><span class="fu">::</span><span class="fu"><a href="../reference/chunks_get_var.html">chunks_get_var</a></span><span class="op">(</span><span class="st">"c"</span><span class="op">)</span> <span class="op">==</span> <span class="fl">4</span><span class="op">)</span>
<span class="fu">teal.code</span><span class="fu">::</span><span class="fu"><a href="../reference/chunks_push.html">chunks_push</a></span><span class="op">(</span>expression <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">quote</a></span><span class="op">(</span><span class="va">a</span> <span class="op">+</span> <span class="va">b</span> <span class="op">+</span> <span class="va">c</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu">teal.code</span><span class="fu">::</span><span class="fu"><a href="../reference/chunks_safe_eval.html">chunks_safe_eval</a></span><span class="op">(</span><span class="op">)</span> <span class="op">==</span> <span class="fl">8</span><span class="op">)</span>
<span class="co"># create a new chunks object explicitly</span>
<span class="va">chunks2</span> <span class="op">&lt;-</span> <span class="fu">teal.code</span><span class="fu">::</span><span class="va"><a href="../reference/chunks.html">chunks</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span>
<span class="co"># push into this object</span>
<span class="fu">teal.code</span><span class="fu">::</span><span class="fu"><a href="../reference/chunks_push.html">chunks_push</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/bquote.html" class="external-link">bquote</a></span><span class="op">(</span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">)</span>, chunks <span class="op">=</span> <span class="va">chunks2</span><span class="op">)</span>
<span class="co"># push the whole of chunks2 into our main chunks object</span>
<span class="fu">teal.code</span><span class="fu">::</span><span class="fu"><a href="../reference/chunks_push_chunks.html">chunks_push_chunks</a></span><span class="op">(</span><span class="va">chunks2</span><span class="op">)</span>
<span class="co"># evaluate and get results</span>
<span class="fu">teal.code</span><span class="fu">::</span><span class="fu"><a href="../reference/chunks_safe_eval.html">chunks_safe_eval</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] 1</span></code></pre>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">teal.code</span><span class="fu">::</span><span class="fu"><a href="../reference/chunks_get_var.html">chunks_get_var</a></span><span class="op">(</span><span class="st">"d"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] 1</span></code></pre>
<p>The <em>default</em> <code>chunks</code> object in many
<code>teal.code</code> functions is the <code>chunks</code> object
coupled to the shiny session. But as shown above it is possible to use
other <code>chunk</code> objects with these functions using their
<code>chunks</code> argument. The <code>chunks</code> object is an R6
object and consult the function documentation for details of its
explicit methods.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="nest">
  <p>teal.code is a part of the <strong>NEST</strong> and <a href="https://pharmaverse.org/" class="external-link"><strong>pharmaverse</strong></a>.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
